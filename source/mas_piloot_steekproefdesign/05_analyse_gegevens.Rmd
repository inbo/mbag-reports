# Analyse beschikbare ABV- en MAS-gegevens {#analyse-gegevens}

-   Berekening verklarende variabelen (GIS-analyse)
-   Resultaten
    -   Data exploratie
    -   analyse dubbeltellingen
-   Case study veldleeuwerik
    -   densiteitsschattingen distance sampling
    -   beheerovereenkomsten analyse
    -   totaalanalyse projpred

## Berekening verklarende variabelen

\textcolor{red}{logischer na volgend hoofdstuk?}

## Data exploratie MAS-tellingen

### Enkele cijfers

Binnen het pilootmeetnet worden al sinds 2018 tellingen verricht.
\textcolor{red}{ABV? of van waar komen deze eigenlijk?} Zoals besproken in Hoofdstuk \@ref(pilootgegevens) zijn een aantal van deze punten hergebruikt bij de steekproeftrekking voor deze pilootstudie.
Verder zijn er sinds de pilootstudie (2022) veel telpunten bijgekomen in De Moeren en de Oostelijke leemstreek (Tabel \@ref(tab:samenvatting-aantallen)).
De meeste telpunten werden vier maal per jaar bezocht (Fig. \@ref(fig:telintensiteit)).
Een telling is hier geïnterpreteerd als een waarneming van een bepaalde soort op een bepaalde afstand op een bepaald telpunt in een bepaalde telperiode.
Er is dus geen rekening gehouden met het aantal vogels genoteerd per telling.
Het aantal tellingen was hoger in de Leemstreek maar daar waren ook meer telpunten.
Figuren \@ref(fig:aantal-waarnemingen) en \@ref(fig:aantal-soorten) geven een meer gedetailleerd beeld van de verdelingen van respectievelijk het aantal waarnemingen en soorten per jaar.

```{r samenvatting-aantallen}
summary_mas_2018_2023 <- read_csv(file.path("media", "data_exploratie",
                                            "summary_mas_2018_2023.csv"),
                                  show_col_types = FALSE)
summary_mas_2018_2023 %>%
  group_by(regio, jaar, aantal_soorten_regiojaar) %>%
  summarise(`aantal waarnemingen` = sum(aantal_waarnemingen),
            `aantal telpunten` = sum(aantal_plots),
            .groups = "drop") %>%
  select(regio, jaar, `aantal telpunten`, `aantal waarnemingen`,
         `aantal soorten` = aantal_soorten_regiojaar) %>%
  arrange(regio, jaar) %>%
  kable(caption = "Samenvattende tabel aantallen binnen het pilootmeetnet.")
```

```{r telintensiteit, out.width = "90%", fig.cap = "Aantal tellingen per jaar in elke regio."}
include_graphics(file.path("media", "data_exploratie",
                           "tellingen_mas_2018_2023.pdf"))
```

```{r aantal-waarnemingen, out.width = "100%", fig.cap = "Verdeling van het aantal waarnemingen per jaar in elke regio."}
include_graphics(file.path("media", "data_exploratie",
                           "waarnemingen_mas_2018_2023.pdf"))
```

```{r aantal-soorten, out.width = "100%", fig.cap = "Verdeling van het aantal soorten per jaar in elke regio."}
include_graphics(file.path("media", "data_exploratie",
                           "soorten_mas_2018_2023.pdf"))
```

### Broedcodes

Het gebruik van het scoren van verschillende broedcodes bij elke waarneming geeft het voordeel dat we uitspraken kunnen doen in termen van aantal broedgevallen door toevallige waarnemingen van een soort (bv. een overvliegend individu) uit te sluiten (broedcode nul).
\textcolor{red}{referenties?} We beschouwen tien doelsoorten: Geelgors, Gele kwikstaart, Grasmus, Kievit, Kneu, Kwartel, Ringmus, Torenvalk, Veldleeuwerik en Witte kwikstaart.
Als we kijken naar de data van 2022-2023, zien we dat de rapportage van broedcodes sterk kan verschillen van soort tot soort (Fig. \@ref(fig:broedcodes)).
\textcolor{red}{bespreking Johannes? bv verschil witte kwik ringmus, torenvalk, veldleeuwerik? en uitleggen dat we voor roofvogels geen rekening houden met broedcodes}

```{r broedcodes, out.width = "100%", fig.cap = "Aantal tellingen per broedcode per doelsoort voor 2022-2023."}
include_graphics(file.path("media", "data_exploratie",
                           "broedcode_mas_2022_2023.pdf"))
```

### Relatieve frequenties

Voor elke soort kunnen we de relatieve frequentie ($P$) berekenen als de proportie telpunten waarin de soort aanwezig is per telperiode, jaar en regio.
Een relatieve frequentie van 0,5 wil dus zeggen dat de soort in 50 % van de telpunten gezien is.

$$
P = \sum_{i=1}^{N} I(n_i > 0) / N
$$

Waarbij $N$ het totaal aantal telpunten is in telperiode, jaar en regio en $n_i$ het aantal individuen van de beschouwde soort waargenomen van telpunt $i$.
$I(\cdot)$ is de indicatorfunctie die 1 geeft als $n_i > 0$ en 0 anderzijds.
We selecteerden enkel waarnemingen met broedcode groter dan nul.
Voor roofvogels hielden we geen rekening met broedcode, \textcolor{red}{omdat?}.

Figuur \@ref(fig:relfreqs) toont de relatieve frequenties van de 20 meest frequente soorten (gemiddeld over telperiode, jaar en regio).
Een beperkt aantal soorten werd gezien in meer dan 50 % van de telpunten in een bepaalde telperiode, de meeste werden minder frequent gezien.
Het is duidelijk dat bepaalde soorten algemener zijn in de ene of de andere regio.
Als we het verschil in relatieve frequentie tussen De Moeren en de Oostelijke leemstreek nemen, zien we om welke soorten het gaat (Fig. \@ref(fig:verschilfreqs)).
\textcolor{red}{Typische soorten van open landschap, water en rietkragen werden meer gezien in De Moeren zoals Kievit, Bruine kiekendief, Rietzanger, Wilde eend Kleine karrekiet enzovoort. In de Oostelijke leemstreek zien we dan weer soorten van meer halfopen landschap en kleine landschapselementen zoals Veldleeuwerik, Geelgors, Vink enzovoort.}

```{r relfreqs, out.width = "90%", fig.cap = "Relatieve frequentie van de 20 meest frequente soorten (gemiddeld over telperiode, jaar en regio) en doelsoorten (in vet rood, onder stippellijn indien niet in top 20). Elke punt is een relatieve frequentie in een bepaalde telperiode, jaar en regio."}
include_graphics(file.path("media", "data_exploratie",
                           "soortenfreqs_mas_2018_2023.pdf"))
```

```{r verschilfreqs, out.width = "90%", fig.cap = "Verschil in relatieve frequentie tussen De Moeren en de Oostelijke leemstreek. Top 10 meer algemene soorten in De Moeren van boven naar onder, top 10 meer algemene soorten in de Oostelijke leemstreek van onder naar boven (gemiddeld over telperiode en jaar) en doelsoorten (in vet rood, tussen stippellijn indien niet in top 10 van een regio). Elke punt is een verschil in relatieve frequentie in een bepaalde telperiode en jaar tussen De Moeren en de Oostelijke leemstreek."}
include_graphics(file.path("media", "data_exploratie",
                           "verschilfreq_total_mas_2018_2023.pdf"))
```

### Evolutie toename soortbeschermingsmaatregelen

...

### Zoogdieren

...

## Vergelijking van gepaarde tellingen tussen vrijwilligers en professionele tellers

### Inleiding

Tellingen worden verricht door zowel vrijwilligers als professionele tellers.
In 2022 werden elf telpunten in De Moeren zowel door vrijwilligers als door een professionele teller in dezelfde telperiodes geteld.
Met deze opzet wilden we achterhalen of tellingen van vrijwilligers en een professionele teller gelijkaardige resultaten opleveren.
We waren vooral geïnteresseerd in waarnemingen met broedcode groter dan nul, omdat waarnemingen met broedcode 0 meer op toeval berust zijn (trekkers/pleisteraars of roofvogels).

### Methodiek

In totaal werden tien telpunten in vier telperiodes en één telpunt in drie telperiodes geteld door zowel een vrijwilliger als een professionele teller.
We beschikten dus over `r 10 * 4 + 3` gepaarde datapunten.
De telpunten werden geteld door zeven verschillende vrijwilligers die geclassificeerd konden worden als "beginner" en "ervaren".

We wilden achterhalen of tellingen van vrijwilligers en een professionele teller gelijkaardige resultaten opleveren.
Dit deden we door het aantal soorten en aantal waarnemingen te vergelijken tussen beide.
Verder keken we ook naar het effect van broedcode en ervaring van de vrijwilligers.
Analyses werden gedaan via Bayesiaanse generalized linear mixed models (GLMM's) met de **brms** package v2.19.0 [@bürkner2017; @bürkner2018; @bürkner2021] met standaard priors.
We vergeleken telkens drie verschillende responsdistributies (en link functies $g()$).

-   Normaal verdeling (identity link)
-   Poisson verdeling (log link)
-   Negatief binomiaal verdeling (log link)

We stelden de volgende onderzoeksvragen en bijbehorende modellen op:

**Aantal soorten/waarnemingen**

Is er een verschil in het aantal soorten/waarnemingen met broedcode groter dan nul gezien door de professionele teller vs. de vrijwilligers?

Beschouw $Y_{ijk}$ een observatie $i$ van een aantal soorten/waarnemingen in plot $j$ en telperiode $k$.
Deze observaties zijn door zowel een professionele teller $X_{status} = 0$ als een vrijwillige teller $X_{status} = 1$ gedaan.
We voegen een random effect toe van telperiode genest in plot $b_{1}$.
Bovendien kunnen aantallen van eenzelfde plot meer op elkaar lijken dan aantallen dan aantallen van verschillende telpunten.
We voegen ook een random effect toe van plot $b_{2}$.

$$
g(\text{E}(Y_{ijk})) = \beta_0 + \beta_{1}X_{status, i} + b_{1,jk} + b_{2,k}
$$

We besluiten dat er een significant verschil is als het 95 % credible interval (CI) van $\beta_1$ nul niet bevat.

**Effect van broedcode**

Kan een verschil in aantal soorten of aantal waarnemingen tussen professionele en vrijwillige tellers verschillen tussen broedcodes?

We voegden de data met broedcode nul toe en maakten een extra dummyvariabele aan die een onderscheid maakt tussen data met broedcode nul $X_{broedcode} = 0$ en data met broedcode groter dan nul.

$$
g(\text{E}(Y_{ijk})) = \beta_0 + \beta_{1}X_{status, i} + \beta_{2}X_{broedcode, i} + \beta_{3}X_{status, i} \times X_{broedcodee, i}+ b_{1,jk} + b_{2,k}
$$

We besluiten dat er een significant verschillend effect van broedcode is als het 95 % credible interval van $\beta_3$ nul niet bevat.

**Effect van ervaring**

Is er een verschil in het aantal soorten of aantal waarnemingen met broedcode groter dan nul tussen ervaren en beginnende vrijwillige tellers?

De professionele teller is ervaren, maar bij de vrijwilligers hebben we twee ervaringscategorieën: "beginner" ($X_{ervaring} = 0$) en "ervaren" ($X_{ervaring} = 1$).

$$
g(\text{E}(Y_{ijk})) = \beta_0 + \beta_{1}X_{status, i} + \beta_{2}X_{ervaring, i} + \beta_{3}X_{status, i} \times X_{ervaring, i} + b_{1,jk} + b_{2,k}
$$

We besluiten dat er een significant verschillend effect van broedcode is als het 95 % credible interval van $\beta_3$ nul niet bevat.

**Correlatie tussen aantal soorten en aantal waarnemingen**

Ten slotte onderzochten we het verband tussen het aantal soorten en het aantal waarnemingen met broedcode groter dan nul.
Is er een verschil in de mate waarin aantal soorten toe- of afneemt met het aantal waarnemingen voor professionele teller in vergelijking met vrijwilligers?

Beschouw $Y_{ij}$ een observatie $i$ van een aantal soorten in plot $j$ en $X_{wnm}$ een variabele van het aantal waarnemingen.
We fitten een model waarbij de intercepten voor zowel de professionele teller ($\beta_0$) als de vrijwilligers ($\beta_0 + \beta_2$) gelijk zijn aan nul (nul soorten bij nul waarnemingen).
We hebben dus enkel een slope voor de professionele teller ($\beta_1$) en een slope voor de vrijwilligers ($\beta_1 + \beta_3$).
We voegden random slopes toe per plot $j$ voor professionelen ($b_1$) en vrijwilligers ($b_1 + b_2$).

$$
\text{E}(Y_{ij}) = \beta_{1}\ln{(X_{wnm, i})} + \beta_{2}\ln{(X_{wnm, i})}\times X_{status, i}  + b_{1,j}\ln{(X_{wnm, i})} + b_{2,j}\ln{(X_{wnm, i})}\times X_{status, i}
$$

We besluiten dat er een significant verschil is als het 95 % credible interval van $\beta_2$ nul niet bevat.

We bemonsterden de posterior verdelingen voor de modellen met drie Markov Chain Monte Carlo (MCMC) ketens, die elk 4000 iteraties draaiden, waarvan de eerste 2000 werden verwijderd als burn-in.
We onderzochten MCMC-convergentie door visuele beoordeling van trace plots en posterior densiteiten.
We onderzochten ook de 'potential scale reduction factors' [@gelman1992] voor elke scalaire parameter in het model zoals voorgesteld door [@gelman2013].
Ze lagen allemaal dicht bij 1, zoals vereist.

Via 'Leave-One-Out Cross-Validation' vergeleken we eerste welke responsdistributie het best paste bij de data en ten tweede of het random effect van plot $b_{2}$ noodzakelijk was of niet (niet gedaan bij correlatie model).
De model fit werd bevestigd op basis van 'posterior predictive checks' waarbij we de geobserveerde uitkomst vergeleken met gesimuleerde datasets van de 'posterior predictive distribution'.

### Resultaten en discussie

Onze primaire interesse ging uit naar een verschil tussen professionele teller en vrijwilligers voor soorten met broedcode groter dan nul.
We zagen dat vrijwilligers een significant minder aantal waarnemingen (95 % CI: -5,94 tot -3,04) en soorten (95 % CI: -4,22 tot -2.20) meldden dan de professionele teller (Fig. \@ref(fig:dubbeltellingen-aantallen)).
Verdere exploratie maakte duidelijk dat dit verschil in aantal soorten gelijkaardig is voor broedcode nul en broedcode groter dan nul (95 % CI: -0,21 tot 0,25).
Model fit was niet ideaal en in werkelijkheid verwachten we zelfs dat het verschil in aantal soorten met broedcode 0 nog lager ligt voor vrijwilligers in vergelijking met het verschil bij broedcode groter dan 0 omdat het aantal nultellingen door het model onderschat werd.
We hebben dus zeker geen bewijs dat er compensatie zou zijn bij de vrijwilligers waarbij ze wel meer soorten zouden noteren met broedcode nul, maar minder met broedcode groter dan nul.
Voor aantal waarnemingen konden we hetzelfde besluiten (95 % CI: -0,2 tot 0,24).

```{r dubbeltellingen-aantallen, out.width = "90%", fig.cap = "Verschil in aantal soorten en waarnemingen van vogels met broedcode groter dan nul tussen vrijwilligers en professionele tellers met aanduiding van posterior gemiddelde en 95  \\% credible interval."}
include_graphics(file.path("media", "dubbeltellingen",
                           "vergelijk_aantallen.pdf"))
```

Ook vonden we dat er geen significant verschil was in aantal soorten (data broedcode \> 0) tussen beginnende en ervaren vrijwilligers (95 % CI: -1,86 tot 1,13).
Voor aantal waarnemingen konden we hetzelfde besluiten (95 % CI: -1,09 tot 3,73).

We moeten opmerken dat deze resultaten gebaseerd zijn op modellen die niet altijd een goede weerspiegeling waren van de data.
De responsdata waren aantallen en dus positief en discreet van aard.
Desondanks kozen we vaak voor modellen met een Normale verdeling.
Dit gaf eenvoudig interpreteerbare resultaten en was ook vaak niet problematisch omdat de aantallen vaak hoog genoeg lagen (en er dus geen negatieve waarden zouden voorspeld worden door het model).
In verschillende gevallen werden de resultaten van de Poisson en Negatief binomiaal modellen vergeleken met het Normaal model.
Na omrekenen gaven deze modellen gelijkaardige resultaten.
Bovendien waren we telkens geïnteresseerd in specifieke hypotheses.
Hoewel precieze credible intervals van de verschillende modellen wel verschilden, gaven ze wel een eenduidig antwoord op onze vragen.
Deze waren ook telkens in lijn met de data exploratie.

Ten slotte kozen we het aantal soorten en het aantal waarnemingen als maten om te achterhalen of tellingen van vrijwilligers en de professionele teller gelijkaardige resultaten opleverden.
Dit zijn geen onafhankelijke maten.
Zoals verwacht toonden we aan dat deze log-lineair verwant zijn aan elkaar.
Hoe meer waarnemingen, hoe meer soorten.
Naarmate het aantal waarnemingen een bepaalde grootte overschrijdt, vlakt het aantal soorten af.
Ook hier zagen we een verschil tussen professionele en vrijwillige tellers met over de totale range van aantal waarnemingen een lager aantal soorten gezien door vrijwillige tellers (95 % CI: -1,2 tot -0,28) (Fig. \@ref(fig:dubbeltellingen-correlatie)).

```{r dubbeltellingen-correlatie, out.width = "90%", fig.cap = "Verband tussen het aantal soorten en aantal waarnemingen van vogels met broedcode groter dan nul (posterior gemiddelde en 95  \\% credible interval)."}
include_graphics(file.path("media", "dubbeltellingen",
                           "correlatie_aantallen.pdf"))
```

We kunnen concluderen dat het effect van teller status belangrijk kan zijn het verder analyseren van de data.

## Case studie: de Veldleeuwerik {#veldleeuwerik}

\textcolor{red}{waarom veldleeuwerik ... De resultaten van andere soorten zullen in een ander rapport worden beschreven.}

### Data exploratie {#exploratie-veldleeuwerik}

...

### Densiteitsschattingen en detectiekans {#densiteitsschattingen}

\textcolor{red}{densiteitsschattingen via distance sampling}

#### Inleiding tot distance sampling {#inleiding-distance}

Distance sampling is een techniek om de abundantie en/of densiteit van biologische populaties te schatten op basis van een steekproef uit de populatie.
Het is namelijk in de praktijk quasi nooit mogelijk om elk individu te tellen.
Dieren staan constant in beweging en interageren op allerlei manier met elkaar en hun omgeving.
Afhankelijk van de eigenschappen van een soort en de omgeving kan de de detectiekans van een soort verschillen.
Een idee over de detectiekans van een soort is bijgevolg van belang om een schatting van de volledige populatie te maken vanuit de steekproef.
Een andere bekende techniek om abundanties te schatten is capture-recapture.
Hierbij zit de informatie over de detectiekans in de vangstgeschiedenis van verschillende individuen.
In distance sampling daarentegen zit informatie over detecteerbaarheid vervat in de detectieafstanden.
Het onderliggende idee van beide benaderingen is dat, als we de detectiekans kunnen schatten voor de individuen die we detecteren, we ook kunnen schatten hoeveel er niet opgemerkt werden.
Op basis van die schatting van detectiekans, kunnen we de waargenomen tellingen corrigeren voor individuen die op de bemonsterde telpunten zijn gemist.
Het voordeel van distance sampling ten opzichte van capture-recapture is dat het niet vereist is dat individuen worden gemarkeerd en opnieuw worden gevangen/waargenomen in de loop van de tijd.
Bovendien kan slechts een enkele steekproef van de populatie voldoende zijn [@buckland2015; @buckland2001].\

Wanneer we het over distance sampling hebben in dit rapport, spreken we eigenlijk over conventional distance sampling (CDS).
In CDS worden de data gebundeld voor het schatten van de detectiekans.
Dit is in tegenstelling tot hierarchical distance sampling (HDS), waarbij de focus ligt op lokale populatiegroottes van de steekproefeenheden door het maken van expliciete modellen die de variatie in populatiegrootte tussen steekproefeenheden verklaren [@kéry2016].
HDS wordt hier verder niet besproken.
De belangrijkste aannames van de CDS-methode zijn [@buckland2001, hoofdstuk 2]:

1.  Dieren zijn uniform verdeeld over de ruimte (steekproefdesign)\
    (= random plaatsing van steekproefeenheden t.o.v. verdeling dieren)

2.  Detectiekans is een functie van afstand en is gelijk aan 1 op afstand 0 (model)

3.  Individuen worden gedetecteerd op hun oorspronkelijke locatie (model)

4.  Afstanden worden foutloos gemeten (model)

Distance sampling is erg populair bij het tellen van vogels met behulp van punttransecten [@rosenstock2002; @buckland2001; @roodbergen2011].
Een punttransect is een cirkelvormige plot met radius $w$ waar een waarnemer vanuit een centraal punt de radiale afstand $r_i$ meet tot elk van de gedetecteerde individuen $i = 1, ..., n$ met $n$ het totaal aantal waarnemingen (Fig. \@ref(fig:distance-methode)A).
$w$ wordt ook wel de afknotafstand genoemd.

Om de detectiekans te schatten maak je een model voor de probabiliteit dat een individu van een soort wordt gedetecteerd gegeven we de afstand tot het individu weten.
Dit model is de detectiefunctie (ook wel detectiecurve genoemd) en wordt genoteerd als $g(r;\boldsymbol \theta)$ met $r$ de radiale afstand van waarneming tot teller/telpunt en $\boldsymbol \theta$ een vector van parameters die geschat moeten worden.
Het doel is de gemiddelde kans op detectie ($p$) te bepalen.
Dit is het gemiddelde over afstand van 0 m tot de afknotafstand $w$, in ons geval $w = 300$.
De term $\frac{2r}{w^2}$ is nodig om rekening te houden met de geometrie van de plot (cirkel).

$$
p = \int_0^w\frac{2r}{w^2}g(r;\boldsymbol \theta)\,dr
$$

$p$ is dus de oppervlakte onder de detectiecurve.
Figuur \@ref(fig:distance-methode)B toont een fictief voorbeeld van een histogram met afstanden van 0 tot 300 meter ($w = 300$).
Hoe groter de afstand, hoe minder waarnemingen en dus lager de detectiekans.
Moest het aantal waarnemingen niet afnemen over de afstand, zouden de afstanden uniform verdeeld zijn zoals de rode box.
Alles zou gezien zijn en de detectiekans op elke afstand is gelijk aan 1.
De blauwe curve is een half-normale detectiecurve gefit op de data.
De oppervlakte onder de curve binnen de box is de gemiddelde detectiekans $p$ (de geschatte fractie dieren die gezien zijn).
De oppervlakte boven de curve binnen de box de geschatte fractie dieren die gemist zijn.
Als we de gemiddelde detectiekans weten, kunnen we dus eenvoudig berekenen hoeveel dieren we verwachten als we uitgaan van een uniforme verdeling van dieren over de telcirkel (zie verder).
We controleren er dus voor dat het moeilijker is om dieren te detecteren op grotere afstand, terwijl we er van uitgaan dat er in werkelijkheid evenveel zitten op grotere als op kleinere afstanden.

```{r distance-methode, out.width = "90%", fig.cap = "Methodologie distance sampling. \\textbf{A.} Punttransect met radius $w$ en observatie $i$ op afstand $r$. \\textbf{B.} Histogram en detectiecurve gefit op 1000 gesimuleerde datapunten uit de half-normale verdeling met parameter $\\sigma = 120$ en afknotafstand 300 m. De oppervlakte onder de curve binnen de rode box is de gemiddelde detectiekans $p$."}
include_graphics(file.path("media", "distance", "methode_distance.pdf"))
```

Voor de formulatie van de detectiefunctie beschouwen we half-normal en hazard-rate sleutelfuncties die we laten afhangen van categorische covariaten $\mathbf{z_i}$ (bv. jaar, regio).
Met $\mathbf{z_i}$ een vector van $J$ covariaten geassocieerd met observatie $i$.
Dit wordt ook wel multiple-covariate distance sampling (MCDS) genoemd [@marques2007].
De detectiekans wordt dan berekend conditioneel aan de waargenomen waarden van de covariaten.

$$
p(\mathbf{z_i}) = \int_0^w\frac{2r}{w^2}g(r, \mathbf{z_i};\boldsymbol \theta)\,dr
$$

De half-normal sleutelfunctie is van de vorm

$$
g(r, \mathbf{z};\boldsymbol \theta) = \exp{\left( -\frac{r^2}{2\sigma(\mathbf{z})^2} \right)}
$$

en de hazard-rate sleutelfunctie

$$
g(r, \mathbf{z};\boldsymbol \theta) = 1 - \exp{\left( \left( -\frac{r}{\sigma(\mathbf{z})}\right)^{-b} \right)}
$$

waarbij de scale parameter in beide gevallen gelijk is aan

$$
\sigma(\mathbf{z}) = \exp{\left( \beta_0 + \sum_{j = 1}^{J} \beta_j z_j \right)}
$$

De hazard-rate key function heeft naast de scale parameter ook nog de shape parameter $b$.

Wanneer we de detectiecurve gefit hebben, hebben we dus een idee van de detectiekans; en deze kan verschillend zijn afhankelijk van bepaalde covariaten.
We kunnen daarna de densiteiten berekenen voor bepaalde strata binnen de studieregio (bv. apart voor De Moeren en de Oostelijke leemstreek).
Beschouw $A(s)$ de totale oppervlakte van stratum $s$ tot waar we de abundantieschatting willen extrapoleren en $a(s)$ het gesampelde gebied.

$$
a(s) = \pi w^2 T
$$

Met $T$ het aantal telpunten ($n_p$) vermenigvuldigd met het aantal bezoeken (effort).
Dan is de geschatte abundantie in het gesampelde gebied voor elk stratum $s$:

$$
\hat{N}_C(s) = \sum_{i=1}^n \frac{c_i(s)}{\hat{p}(\mathbf{z_i})}
$$

Met $c_i(s)$ de clustergrootte in stratum $s$ voor waarneming $i$.

Meestal is $c_i(s) = 1$, maar soms bestaat een waarneming uit meerdere individuen die gezien waren op dezelfde afstand op hetzelfde moment.
De geschatte abundantie in het gesampelde gebied kan dan worden opgeschaald naar de totale oppervlakte van het stratum via:

$$
\hat{N}(s) = \frac{A(s)}{a(s)}\hat{N}_C(s)
$$

De geschatte densiteit in stratum $s$ is dan $\hat{N}(s) / A(s)$.
De abundanties kunnen ook opgeteld worden voor een totale schatting $\hat{N}_C$.
Een maat voor de gemiddelde detectiekans $\hat{P}_a$ is dan:

$$
\hat{P}_a = \frac{n}{\hat{N}_C}
$$

De onzekerheid op de abundantie- en densiteitsschattingen komt van twee origines [@miller2019]:

1.  Detectiefunctie: Onzekerheid in parameterschattingen ($\boldsymbol \theta$)
2.  Trefkans: Bemonsteringsvariabiliteit als gevolg van verschillen in het aantal waarnemingen per transect

#### Methodiek densiteitsschattingen

We voerden de distance sampling analyses uit met behulp van de **Distance** package [@R-Distance; @miller2019].
We schatten (1) densiteiten per jaar (2018-2023) per regio (De Moeren, Oostelijke leemstreek) en (2) densiteiten per stratum (OL, HOL en binnen en buiten sbp) per regio binnen de pilootstudie (2022-2023).
We beschouwen enkel waarnemingen van Veldleeuwerik met broedcode groter dan nul en houden ook rekening met het broedseizoen van de soort.
Alle vier de verschillende telperiodes vallen binnen het broedseizoen van de soort (1 april - 15 juli) zodat we de data van alle telperiodes binnen het jaar konden gebruiken.

Voor (1) beschouwden we alle telpunten van 2018-2021 en voegden enkel telpunten van 2022 en 2023 toe als ze minstens eenmaal geteld waren in een van de voorgaande jaren.
Om abundanties te schatten, moesten we de oppervlakte van de regio's berekenen voor extrapolatie.
We trokken daarvoor een buffer van 300 m rond het steekproefkader: OL in De Moeren, en OL en HOL in de Oostelijke leemstreek (Fig. \@ref(fig:oppervlakte-steekproefkader-jaar)).
Voor de formulatie van de detectiefunctie beschouwden we half-normal en hazard-rate sleutelfuncties die we lieten afhangen van covariaten regio en jaar.

```{r oppervlakte-steekproefkader-jaar, out.width = "90%", fig.cap = "Oppervlaktes per regio voor berekening densiteiten per jaar per regio."}
include_graphics(file.path("media", "distance", "per_jaar",
                           "oppervlakte_strata.pdf"))
```

Voor (2) beschouwden we enkel de tellingen binnen het pilootproject (alle telpunten van 2022-2023).
We trokken daarvoor ook een buffer van 300 m rond het steekproefkader, deze keer opgesplitst per stratum (Fig. \@ref(fig:oppervlakte-steekproefkader-stratum)).
Voor de formulatie van de detectiefunctie beschouwden we half-normal en hazard-rate sleutelfuncties die we lieten afhangen van covariaten regio, openheid (HOL of OL) en sbp (binnen of buiten sbp).
Analyses werden voor 2022 en 2023 apart gedaan.
Dit was puur om wille van tijdsoverwegingen, maar dit kan ook in eenzelfde analyse worden gedaan (zoals we in (1) doen).
Het gevolg is dat de detectiekansen dus zeker zullen verschillen tussen de jaren ook al beschouwden we jaar niet als covariant in de detectiefunctie.

```{r oppervlakte-steekproefkader-stratum, out.width = "100%", fig.cap = "Oppervlaktes per regio voor berekening densiteiten per stratum per regio."}
include_graphics(file.path("media", "distance", "per_stratum",
                           "oppervlakte_strata.pdf"))
```

We fitten voor (1) en (2) modellen zonder covariaten, met alle combinaties van covariaten en beschouwen ook tweewegsinteracties tussen de covariaten.
De interactie regio met openheid kon niet gefit worden omdat HOL niet in De Moeren voorkomt.
In de modellen zonder covariaten kunnen aanpassingstermen toegevoegd worden om een betere fit te krijgen tussen de curve en de data.
Om te hoge flexibiliteit van dergelijke detectiefunctiemodellen te beperken, bijvoorbeeld aangeraden in aanwezigheid van overdispersie [@buckland2015], beperkten we het aantal aanpassingstermen tot maximaal 2.
De `ds()` functie van de **Distance** package voegt zelf aanpassingstermen toe aan de sleutelfunctie om de fit te verbeteren tot er geen verbetering meer in AIC is.

We vergeleken voor (1) en (2) de AIC van de verschillende modellen.
Als het verschil tussen AIC's kleiner is dan 2, kiezen we het eenvoudigste van deze modellen (model met minste parameters).
Modellen met vergelijkbare AIC's hebben vergelijkbare geschatte detectiekansen, dus in de praktijk is er weinig verschil in de keuze tussen deze modellen [@miller2019].

Om te controleren of onze finale modellen voor (1) en (2) goed pasten bij de data ('goodness of fit') maakten we een Q-Q plot waarbij de cumulatieve distributiefunctie van de gefitte detectiefunctie (CDF) wordt vergeleken met de distributie van de data (EDF).
We voerden ook de Cramér-von Mises test uit.
Deze kwantificeert de informatie van de Q-Q-plot door te testen of punten van de EDF en CDF uit dezelfde verdeling komen [@buckland2015; @miller2019].
Finaal bekeken we ook de kansdichtheidsfunctieplots.
Indien de 'goodness of fit' niet goed was, werd het finale model opnieuw gefit waarbij we de afstanden gegroepeerd werden in intervallen van 50 m.

Densiteitsschattingen werden omgezet naar aantallen per 100 ha.
De onzekerheid op de densiteitsschattingen werd berekend m.b.v. de standaard opties in de `ds()` functie.
Zie @miller2019 en verwijzingen daarin voor meer informatie over de precieze berekeningen.
De onzekerheid op de resultaten zijn telkens 95 % betrouwbaarheidsintervallen.

#### Resultaten densiteitsschattingen

##### Per jaar per regio

```{r}
models_2018_2023 <- readRDS(file.path("media", "distance",
                                      "models_2018_2023.rds"))
ds_veldleeuwerik_2018_2023 <- models_2018_2023$Veldleeuwerik
sum_veldleeuwerik_2018_2023 <- summary(ds_veldleeuwerik_2018_2023)
```

Het Hazard-rate model waarbij de detectiekans afhankelijk is van regio en jaar scoorde het best.
De detectiekansen zijn dus verschillend per regio en jaar (Tabel \@ref(tab:detectiekans-jaar)).
De gemiddelde detectiekans $\hat{P}_a$ is gelijk aan `r round(sum_veldleeuwerik_2018_2023$ds$average.p, digits = 3)` met standaardfout `r round(sum_veldleeuwerik_2018_2023$ds$average.p.se[1, 1], digits = 5)`.
Omwille van de slechtere 'goodness of fit' werd dit model opnieuw gefit waarbij de afstanden gegroepeerd werden in intervallen van 50 m.
De fit was dan beter maar nog altijd niet ideaal.
Dit is ook te zien wanneer we de gemiddelde detectiecurve op de data plotten (Fig. \@ref(fig:detectiekans-jaar-plot)).

```{r detectiekans-jaar}
veldleeuwerik_covars <- c("regio", "jaar")
cbind(ds_veldleeuwerik_2018_2023$ddf$data,
      "detectiekans" = predict(ds_veldleeuwerik_2018_2023,
                       se.fit = TRUE)$fitted,
      "standaardfout" = predict(ds_veldleeuwerik_2018_2023,
                                 se.fit = TRUE)$se) %>%
  select(all_of(veldleeuwerik_covars), "detectiekans", "standaardfout") %>%
  distinct() %>%
  arrange(regio, jaar) %>%
  kable(digits = 3,
        caption = "Detectiekans per regio en jaar voor Veldleeuwerik.")
```

```{r detectiekans-jaar-plot, out.width = "90%", fig.cap = "Gemiddelde detectiecurve geplot over de data. De verticale streepjes op de x-as geven de locaties van de ruwe data aan."}
include_graphics(file.path("media", "distance", "per_jaar",
                           "detectiekans_per_jaar_simple_veldleeuwerik.pdf"))
```

```{r}
summary_results_2018_2023 <- bind_rows(
  sum_veldleeuwerik_2018_2023$dht$individuals$D %>%
    mutate(variable = "density",
           type = "Aantal broedparen per 100 ha"),
  sum_veldleeuwerik_2018_2023$dht$individuals$N %>%
    mutate(variable = "abundance",
           type = "Totaal aantal broedparen")
  ) %>%
  dplyr::filter(Label != "Total") %>%
  separate(Label, into = c("regio", "jaar"), sep = " - ")
```

Rekening houdend met de detectiekans, verkrijgen we via de formules besproken in het vorige hoofdstuk de abundantieschattingen in Tabel \@ref(tab:abundantie-jaar).
Door te delen door de oppervlaktes van elk stratum (regio, jaar) krijgen we de densiteitsschattingen in Tabel \@ref(tab:densiteit-jaar) (Fig. \@ref(fig:densiteit-jaar-plot)).

```{r abundantie-jaar}
summary_results_2018_2023 %>%
  dplyr::filter(variable == "abundance") %>%
  select(regio, jaar, "abundantie" = Estimate, "standaardfout" = se,
         lcl, ucl) %>%
  kable(digits = 1,
        caption = paste("Abundantieschattingen per regio en jaar voor",
          "Veldleeuwerik. `lcl' staat voor `lower confidence limit' de",
          "ondergrens van het 95 \\% betrouwbaarheidsinterval en `ucl' (`upper",
          "confidence limit') voor de bovengrens."))
```

```{r densiteit-jaar}
summary_results_2018_2023 %>%
  dplyr::filter(variable == "density") %>%
  select(regio, jaar, "densiteit" = Estimate, "standaardfout" = se,
         lcl, ucl) %>%
  kable(digits = 2,
        caption = paste("Densiteitsschattingen per 100 ha per regio en jaar",
                        "voor Veldleeuwerik."))
```

```{r densiteit-jaar-plot, out.width = "90%", fig.cap = "Densiteitsschattingen per 100 ha met 95 \\% betrouwbaarheidsintervallen per jaar per regio."}
include_graphics(file.path("media", "distance", "per_jaar",
                           "densiteit_per_jaar_veldleeuwerik.pdf"))
```

##### Per stratum binnen pilootstudie

```{r}
# 2022
models_2022 <- readRDS(file.path("media", "distance", "models_2022.rds"))
ds_veldleeuwerik_2022 <- models_2022$Veldleeuwerik
sum_veldleeuwerik_2022 <- summary(ds_veldleeuwerik_2022)

# 2023
models_2023 <- readRDS(file.path("media", "distance", "models_2023.rds"))
ds_veldleeuwerik_2023 <- models_2023$Veldleeuwerik
sum_veldleeuwerik_2023 <- summary(ds_veldleeuwerik_2023)
```

Het Hazard-rate model waarbij de detectiekans afhankelijk is van openheid scoorde het best voor zowel het model met data van 2022 als van 2023.
De detectiekansen zijn dus verschillend per openheidsklasse HOL en OL (Tabel \@ref(tab:detectiekans-stratum)).
De gemiddelde detectiekans $\hat{P}_a$ is gelijk aan `r round(sum_veldleeuwerik_2022$ds$average.p, digits = 3)` met standaardfout `r round(sum_veldleeuwerik_2022$ds$average.p.se[1, 1], digits = 5)` voor 2022 en `r round(sum_veldleeuwerik_2023$ds$average.p, digits = 3)` met standaardfout `r round(sum_veldleeuwerik_2023$ds$average.p.se[1, 1], digits = 5)`.
Omwille van de slechtere 'goodness of fit' werd dit model opnieuw gefit waarbij de afstanden gegroepeerd werden in intervallen van 50 m.
De fit was dan beter maar nog altijd niet ideaal.
Dit is ook te zien wanneer we de gemiddelde detectiecurve op de data plotten (Fig. \@ref(fig:detectiekans-stratum-plot)).

```{r detectiekans-stratum}
veldleeuwerik_covars <- c("openheid", "jaar")
cbind(ds_veldleeuwerik_2022$ddf$data,
      "detectiekans" = predict(ds_veldleeuwerik_2022,
                       se.fit = TRUE)$fitted,
      "standaardfout" = predict(ds_veldleeuwerik_2022,
                                 se.fit = TRUE)$se) %>%
  mutate(jaar = 2022) %>%
  bind_rows(
    cbind(ds_veldleeuwerik_2023$ddf$data,
      "detectiekans" = predict(ds_veldleeuwerik_2023,
                       se.fit = TRUE)$fitted,
      "standaardfout" = predict(ds_veldleeuwerik_2023,
                                 se.fit = TRUE)$se) %>%
    mutate(jaar = 2023)
  ) %>%
  select(all_of(veldleeuwerik_covars), "detectiekans", "standaardfout") %>%
  distinct() %>%
  arrange(jaar, openheid) %>%
  kable(digits = 3,
        caption = paste("Detectiekans per openheidsklasse en jaar voor",
                        "Veldleeuwerik."))
```

```{r detectiekans-stratum-plot, out.width = "90%", fig.cap = "Gemiddelde detectiecurve (stippellijn) geplot over de data voor model van elk jaar. Ter vergelijking zijn de detectiecurves per openheidsklasse ook aangegeven."}
include_graphics(file.path("media", "distance", "per_stratum",
                           "detectiekans_per_stratum_veldleeuwerik.pdf"))
```

```{r}
summary_results_2022 <- bind_rows(
  sum_veldleeuwerik_2022$dht$individuals$D %>%
    mutate(variable = "density",
           type = "Aantal broedparen per 100 ha"),
  sum_veldleeuwerik_2022$dht$individuals$N %>%
    mutate(variable = "abundance",
           type = "Totaal aantal broedparen")
  ) %>%
  dplyr::filter(Label != "Total") %>%
  separate(Label, into = c("regio", "openheid", "sbp"), sep = " - ") %>%
  mutate(jaar = 2022)

summary_results_2023 <- bind_rows(
  sum_veldleeuwerik_2023$dht$individuals$D %>%
    mutate(variable = "density",
           type = "Aantal broedparen per 100 ha"),
  sum_veldleeuwerik_2023$dht$individuals$N %>%
    mutate(variable = "abundance",
           type = "Totaal aantal broedparen")
  ) %>%
  dplyr::filter(Label != "Total") %>%
  separate(Label, into = c("regio", "openheid", "sbp"), sep = " - ") %>%
  mutate(jaar = 2023)

summary_results_stratum <- bind_rows(summary_results_2022, summary_results_2023)
```

Rekening houdend met de detectiekans, verkrijgen we via de formules besproken in het vorige hoofdstuk de abundantieschattingen in Tabel \@ref(tab:abundantie-stratum).
Door te delen door de oppervlaktes van elk stratum (regio, jaar) krijgen we de densiteitsschattingen in Tabel \@ref(tab:densiteit-stratum) (Fig. \@ref(fig:densiteit-stratum-plot)).

```{r abundantie-stratum}
summary_results_stratum %>%
  dplyr::filter(variable == "abundance") %>%
  select(regio, jaar, openheid, sbp, "abundantie" = Estimate,
         "standaardfout" = se, lcl, ucl) %>%
  arrange(regio, jaar, openheid, sbp) %>%
  kable(digits = 1,
        caption = paste("Abundantieschattingen per stratum voor",
          "Veldleeuwerik."))
```

```{r densiteit-stratum}
summary_results_stratum %>%
  dplyr::filter(variable == "density") %>%
  select(regio, jaar, openheid, sbp, "densiteit" = Estimate,
         "standaardfout" = se, lcl, ucl) %>%
  arrange(regio, jaar, openheid, sbp) %>%
  kable(digits = 2,
        caption = paste("Densiteitsschattingen per 100 ha per stratum",
                        "voor Veldleeuwerik."))
```

```{r densiteit-stratum-plot, out.width = "90%", fig.cap = "Densiteitsschattingen per 100 ha met 95 \\% betrouwbaarheidsintervallen per stratum."}
include_graphics(file.path("media", "distance", "per_stratum",
                           "densiteit_per_stratum_veldleeuwerik.pdf"))
```

#### Discussie densiteitsschattingen

Distance sampling is een statistische methode die over het algemeen goed werkt in combinatie met het MAS-protocol om densiteiten te schatten.
Echter, we zagen wel dat de fit niet helemaal goed was voor de Veldleeuwerik.
Een aanname van het model is namelijk dat de detectiekans afneemt over de afstand (zie assumpties hoofdstuk \@ref(inleiding-distance)).
@roodbergen2011 hadden voor de Veldleeuwerik gelijkaardige problemen om een passende detectiecurve te fitten.
Zij stellen dat dit kan worden veroorzaakt doordat vogels zich verplaatsen als reactie op de waarnemer of het afronden van afstanden door waarnemers.
Dit laatste is bij ons zeker niet het geval doordat waarnemers een punt aanduiden op de kaart via een app en niet manueel een afstand invoeren.
Het probleem ligt dus waarschijnlijk in het gedrag van de soort.
Veldleeuwerikken vliegen gemakkelijk op bij verstoring waardoor we minder waarnemingen zien op kleinere afstanden en dan weer een groter aantal zien rond ca.
75-100 m.
Bovendien is de soort nog gemakkelijk te horen op grotere afstand zonder exact de locatie te weten.
Hierdoor zien we opnieuw een stijging rond 250 m.
@roodbergen2011 fitten daarom voor deze soort een detectiecurve m.b.v. afstandsintervallen.
Wij groepeerden daarom de afstanden per 50 m.
Hoewel de fit er visueel beter uitzag, waren de densiteitsschattingen en hun onzekerheid quasi identiek aan de eerdere resultaten zonder groepering (resultaten niet getoond).
De toepasbaarheid van de methodiek zal dus sterk verschillen van soort tot soort.
Dit zien we bijvoorbeeld ook als we Kneu en Kievit vergelijken (Fig. \@ref(fig:detectiekans-vergelijking)) waarbij deze laatste ook een soort is die meestal op grotere afstanden wordt gezien o.w.v. het gedrag van de soort.
Hoe dan ook wil dit niet zeggen dat we de resultaten niet kunnen gebruiken.
Voor probleemgevallen zal de detectiefunctie niet dalen in het begin en de detectiekans zal dicht bij één liggen.
Dit zorgt ervoor dat de schatting van de densiteit nog altijd kan gebruikt worden als minimumschatting waarbij de gecorrigeerde aantallen zeer dicht tegen de effectief getelde aantallen zullen liggen.

```{r detectiekans-vergelijking, out.width = "90%", fig.cap = "Vergelijking van de fit van de gemiddelde detectiecurve op de data tussen Kneu en Kievit."}
include_graphics(file.path("media", "distance", "per_jaar",
                           "detectiekans_per_jaar_vergelijking.pdf"))
```

Het is ook mogelijk om densiteiten in te berekenen o.b.v. het maximum aantal broedparen over de telperiodes heen per telpunt per jaar.
Dit kan dan omgerekend worden naar densiteiten per stratum door het gemiddelde nemen per stratum en daarna te delen door de oppervlakte van een telcirkel.
Via bootstrapping kan een betrouwbaarheidsinterval bekomen worden.
De maxima komen voor Veldleeuwerik goed overeen met de resultaten van distance sampling (Fig. \@ref(fig:densiteit-methodiek)).
@wiersma2021 gebruiken de maxima om densiteiten van akkervogels in te schatten.
Ze stellen dat dit minimumschattingen zijn omdat ze niet voor onvolledige trefkans hebben gecorrigeerd.
Echter, wij zien hier dat deze methode niet per se lagere resultaten bekomt dan via distance sampling.
De maxima-methode zal lagere schattingen bekomen als de detectiekans van de soort lager is omdat er dan een sterkere correctie optreedt bij distance sampling die niet zal gebeuren bij de maxima-methode, maar dit is niet per se het geval voor soorten met een hoge detectiekans ($p$ dicht bij 1).
Bovendien wordt er bij distance sampling meer gewicht gegeven aan lage aantallen omdat alle data worden meegenomen in de analyse (gemiddeld aantal per telpunt per jaar via effort $T$) terwijl via de maxima-methode veel lage waardes worden weggefilterd (maximum aantal per telpunt per jaar).
Het verschil tussen beide methodes zal dus afhankelijk zijn van soort tot soort omwille van een combinatie van de detectiekans en zeldzaamheid van een soort (en mogelijk nog andere factoren die hier niet zijn opgenomen).
Zoals in de vorige paragraaf vermeld, kan distance sampling ook als een minimumschatting genomen worden bij hoge detectiekansen, maar deze is mogelijks te strikt in vergelijking met de maxima-methode in biologische context.
Als er 3 broedgevallen gezien zijn in telperiodes 1, 2 en 4, maar slechts 1 in periode 3, dan kan dit laatste puur per toeval zijn en zou je geneigd zijn om te besluiten dat er in die telcirkel 3 broedgevallen zijn (maxima methode) en niet 2.5 (gemiddelde).
Een meer diepgaande analyse tussen beide methodes van meerdere soorten met verschillende detectiekansen zou interessant kunnen zijn, maar dit valt buiten het doel van dit rapport.
\textcolor{red}{of nog uitzoeken?}

```{r densiteit-methodiek, out.width = "90%", fig.cap = "Vergelijking van twee methodes om densiteiten te schatten (Veldleeuwerik). De data bij distance sampling zijn gemiddelde densiteiten over telperiodes heen per telpunt gecorrigeerd voor de detectiekans van de soort in dat stratum. De data bij `gemiddelde van maxima' zijn maxima per telpunt. De puntschattingen en betrouwbaarheidsintervallen zijn bekomen via bootstrapping ($B = 1000$). Voor betere visualisatie hebben we een pseudo-log-transformatie langs de y-as gedaan."}
include_graphics(file.path("media", "distance", "per_stratum",
                           "densiteit_per_stratum_methods_veldleeuwerik.pdf"))
```

\textcolor{red}{uitbreiding distance sampling?} \textcolor{red}{stan etc.}
